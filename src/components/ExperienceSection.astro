---
import type { Experience } from '../types';
import experienceData from '../data/experience.json';
import skillsData from '../data/skills.json';
import { getIconComponent } from '../utils/icons';

interface Props {
  experience?: Experience[];
}

const experience = experienceData as Experience[];
const skills = skillsData;

function formatDate(dateString: string | null): string {
  if (!dateString) return 'Present';
  const date = new Date(dateString);
  return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
}

function getSkillData(skillKey: string) {
  return skills.find(s => s.key === skillKey);
}
---

<section id="experience" class="section">
  <h2 class="text-4xl font-bold text-primary mb-12">Experience</h2>
  
  <div class="space-y-8">
    {experience.map((job) => (
      <div class="card">
        <div class="flex items-start justify-between mb-4">
          <div>
            <h3 class="text-2xl font-bold text-primary">{job.company}</h3>
            <p class="text-lg text-gray-700 font-medium">{job.jobTitle}</p>
          </div>
          <div class="text-right text-sm text-gray-600 whitespace-nowrap ml-4">
            <p>{formatDate(job.startDate)} - {formatDate(job.endDate)}</p>
          </div>
        </div>
        
        {job.url && (
          <a href={job.url} target="_blank" rel="noopener noreferrer" class="text-primary hover:underline text-sm mb-4 inline-block">
            Visit website â†’
          </a>
        )}
        
        <div class="mb-4 space-y-2">
          {job.description.map((desc) => (
            <p class="text-gray-700 leading-relaxed">{desc}</p>
          ))}
        </div>
        
        <div class="flex flex-wrap gap-2">
          {job.skills.map((skillKey) => {
            const skillInfo = getSkillData(skillKey);
            return skillInfo ? (
              <span class="badge">
                {skillInfo.name}
              </span>
            ) : null;
          })}
        </div>
      </div>
    ))}
  </div>
</section>
